!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("ws")):"function"==typeof define&&define.amd?define(["ws"],n):(e="undefined"!=typeof globalThis?globalThis:e||self).GPUjsHiveCompute=n(e.ws)}(this,(function(e){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,n,t){return e(t={path:n,exports:{},require:function(e,n){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==n&&t.path)}},t.exports),t.exports}var o=t((function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ASK_ACTIONS=n.TELL_ACTIONS=n.COMM_TYPE=void 0,function(e){e[e.ASK=0]="ASK",e[e.TELL=1]="TELL",e[e.REQUEST_CONN=2]="REQUEST_CONN"}(n.COMM_TYPE||(n.COMM_TYPE={})),function(e){e[e.KERNEL_BUILT=0]="KERNEL_BUILT",e[e.KERNEL_RUN_DONE=1]="KERNEL_RUN_DONE",e[e.CONN_ACCEPTED=2]="CONN_ACCEPTED"}(n.TELL_ACTIONS||(n.TELL_ACTIONS={})),function(e){e[e.BUILD_KERNEL=0]="BUILD_KERNEL",e[e.RUN_KERNEL=1]="RUN_KERNEL"}(n.ASK_ACTIONS||(n.ASK_ACTIONS={}))})),r=t((function(e,n){function t(e,n){return e.send(JSON.stringify({type:o.COMM_TYPE.TELL,data:n})),e}Object.defineProperty(n,"__esModule",{value:!0}),n.onDisconnect=n.onConnect=n.onTell=n.onAsk=n.tell=n.ask=void 0,n.ask=function(e,n){return e.send(JSON.stringify({type:o.COMM_TYPE.ASK,data:n})),e},n.tell=t,n.onAsk=function(e,n,r){return e.on("message",(function(s){var i=JSON.parse(s);t(e,{action:o.TELL_ACTIONS.CONN_ACCEPTED}),i.type==o.COMM_TYPE.ASK&&i.data.action==n&&r(i.data)})),e},n.onTell=function(e,n,t){return e.on("message",(function(e){var r=JSON.parse(e);r.type==o.COMM_TYPE.TELL&&r.data.action==n&&t(r.data)})),e},n.onConnect=function(e,n){return e.on("message",(function(t){JSON.parse(t).type==o.COMM_TYPE.REQUEST_CONN&&n(e)})),e},n.onDisconnect=function(e,n){return e.on("close",n),e}})),s=t((function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.runHelper=void 0,n.runHelper=function(e,n,t,s){void 0===s&&(s=console.log);var i,l=new e(t);l.on("open",(function(){s("Connecting as helper."),l.send(JSON.stringify({type:o.COMM_TYPE.REQUEST_CONN,data:{}})),r.onTell(l,o.TELL_ACTIONS.CONN_ACCEPTED,(function(){return s("Connection Accepted.")}))})),l.on("close",(function(){return s("Connection refused or closed unexpectedly.")})),r.onAsk(l,o.ASK_ACTIONS.BUILD_KERNEL,(function(e){s("building"),i=n.createKernel(e.extras.kernelFunc,e.extras.kernelOptions),s("built"),r.tell(l,{action:o.TELL_ACTIONS.KERNEL_BUILT})})),r.onAsk(l,o.ASK_ACTIONS.RUN_KERNEL,(function(e){var n;s("running"),n=e.extras.inputsLength>0?i.apply(void 0,e.extras.inputs):i(),s("done"),r.tell(l,{action:o.TELL_ACTIONS.KERNEL_RUN_DONE,extras:{output:n}})}))}})),i=t((function(t,o){var r=n&&n.__assign||function(){return(r=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},i=n&&n.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0}),o.hiveHelp=o.hiveHelpDefaults=void 0;var l=i(e);o.hiveHelpDefaults={logFunction:console.log},o.hiveHelp=function(e){e=r(r({},o.hiveHelpDefaults),e),s.runHelper(l.default,e.gpu,e.url,e.logFunction)}}));const{runHelper:l}=s,{hiveHelpDefaults:u}=i;class a extends WebSocket{openHandlers=[];errHandlers=[];messageHandlers=[];closeHandlers=[];constructor(...e){super(...e),this.onopen=(...e)=>{this.openHandlers.forEach(n=>n(...e))},this.onerror=(...e)=>{this.errHandlers.forEach(n=>n(...e))},this.onmessage=(...e)=>{this.messageHandlers.forEach(n=>n(...e))},this.onclose=(...e)=>{this.closeHandlers.forEach(n=>n(...e))}}on(e,n){switch(e){case"open":this.openHandlers.push(n);break;case"error":this.errHandlers.push(n);break;case"message":this.messageHandlers.push(n);break;case"close":this.closeHandlers.push(n)}}}return{hiveHelp:function(e){e={hiveHelpDefaults:u,...e};const{gpu:n,url:t,logFunction:o}=e;l(a,n,t,o)}}}));

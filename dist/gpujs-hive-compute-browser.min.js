!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("ws")):"function"==typeof define&&define.amd?define(["ws"],n):(e="undefined"!=typeof globalThis?globalThis:e||self).GPUjsHiveCompute=n(e.ws)}(this,(function(e){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,n,t){return e(t={path:n,exports:{},require:function(e,n){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==n&&t.path)}},t.exports),t.exports}var o=t((function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ASK_ACTIONS=n.TELL_ACTIONS=n.COMM_TYPE=void 0,function(e){e[e.ASK=0]="ASK",e[e.TELL=1]="TELL",e[e.REQUEST_CONN=2]="REQUEST_CONN"}(n.COMM_TYPE||(n.COMM_TYPE={})),function(e){e[e.KERNEL_BUILT=0]="KERNEL_BUILT",e[e.KERNEL_RUN_DONE=1]="KERNEL_RUN_DONE",e[e.CONN_ACCEPTED=2]="CONN_ACCEPTED"}(n.TELL_ACTIONS||(n.TELL_ACTIONS={})),function(e){e[e.BUILD_KERNEL=0]="BUILD_KERNEL",e[e.RUN_KERNEL=1]="RUN_KERNEL"}(n.ASK_ACTIONS||(n.ASK_ACTIONS={}))})),r=t((function(e,n){function t(e,n){return e.send(JSON.stringify({type:o.COMM_TYPE.TELL,data:n})),e}Object.defineProperty(n,"__esModule",{value:!0}),n.onDisconnect=n.onConnect=n.onTell=n.onAsk=n.tell=n.ask=void 0,n.ask=function(e,n){return e.send(JSON.stringify({type:o.COMM_TYPE.ASK,data:n})),e},n.tell=t,n.onAsk=function(e,n,r){return e.on("message",(function(i){var u=JSON.parse(i);t(e,{action:o.TELL_ACTIONS.CONN_ACCEPTED}),u.type==o.COMM_TYPE.ASK&&u.data.action==n&&r(u.data)})),e},n.onTell=function(e,n,t){return e.on("message",(function(e){var r=JSON.parse(e);r.type==o.COMM_TYPE.TELL&&r.data.action==n&&t(r.data)})),e},n.onConnect=function(e,n){return e.on("message",(function(t){JSON.parse(t).type==o.COMM_TYPE.REQUEST_CONN&&n(e)})),e},n.onDisconnect=function(e,n){return e.on("close",n),e}})),i=t((function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.runHelper=void 0,n.runHelper=function(e,n,t,i){void 0===i&&(i=console.log);var u,l=new e(t);l.on("open",(function(){i("Connecting as helper."),l.send(JSON.stringify({type:o.COMM_TYPE.REQUEST_CONN,data:{}})),r.onTell(l,o.TELL_ACTIONS.CONN_ACCEPTED,(function(){return i("Connection Accepted.")}))})),l.on("close",(function(){return i("Connection refused or closed unexpectedly.")})),r.onAsk(l,o.ASK_ACTIONS.BUILD_KERNEL,(function(e){i("building"),u=n.createKernel(e.extras.kernelFunc,e.extras.kernelOptions),i("built"),r.tell(l,{action:o.TELL_ACTIONS.KERNEL_BUILT})})),r.onAsk(l,o.ASK_ACTIONS.RUN_KERNEL,(function(e){var n;i("running"),n=e.extras.inputsLength>0?u.apply(void 0,e.extras.inputs):u(),i("done"),r.tell(l,{action:o.TELL_ACTIONS.KERNEL_RUN_DONE,extras:{output:n}})}))}})),u=t((function(t,o){var r=n&&n.__assign||function(){return(r=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)},u=n&&n.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0}),o.hiveHelp=o.hiveHelpDefaults=void 0;var l=u(e);o.hiveHelpDefaults={logFunction:console.log},o.hiveHelp=function(e){e=r(r({},o.hiveHelpDefaults),e),i.runHelper(l.default,e.gpu,e.url,e.logFunction)}}));const{runHelper:l}=i,{hiveHelpDefaults:s}=u;class c extends WebSocket{on(e,n){switch(e){case"open":return this.onopen=n;case"error":return this.onerror=n;case"message":return this.onmessage=n;case"close":return this.onclose=n}}}return{hiveHelp:function(e){e={hiveHelpDefaults:s,...e};const{gpu:n,url:t,logFunction:o}=e;l(c,n,t,o)}}}));

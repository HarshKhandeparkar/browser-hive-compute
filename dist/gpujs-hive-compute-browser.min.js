!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n="undefined"!=typeof globalThis?globalThis:n||self).GPUjsHiveCompute=e()}(this,(function(){"use strict";function n(n,e,t){return n(t={path:e,exports:{},require:function(n,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&t.path)}},t.exports),t.exports}var e=n((function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ASK_ACTIONS=e.TELL_ACTIONS=e.COMM_TYPE=void 0,function(n){n[n.ASK=0]="ASK",n[n.TELL=1]="TELL",n[n.REQUEST_CONN=2]="REQUEST_CONN"}(e.COMM_TYPE||(e.COMM_TYPE={})),function(n){n[n.KERNEL_BUILT=0]="KERNEL_BUILT",n[n.KERNEL_RUN_DONE=1]="KERNEL_RUN_DONE",n[n.CONN_ACCEPTED=2]="CONN_ACCEPTED"}(e.TELL_ACTIONS||(e.TELL_ACTIONS={})),function(n){n[n.BUILD_KERNEL=0]="BUILD_KERNEL",n[n.RUN_KERNEL=1]="RUN_KERNEL"}(e.ASK_ACTIONS||(e.ASK_ACTIONS={}))})),t=n((function(n,t){function o(n,t){return n.send(JSON.stringify({type:e.COMM_TYPE.TELL,data:t})),n}Object.defineProperty(t,"__esModule",{value:!0}),t.onDisconnect=t.onConnect=t.onTell=t.onAsk=t.tell=t.ask=void 0,t.ask=function(n,t){return n.send(JSON.stringify({type:e.COMM_TYPE.ASK,data:t})),n},t.tell=o,t.onAsk=function(n,t,r){return n.on("message",(function(i){var s=JSON.parse(i);o(n,{action:e.TELL_ACTIONS.CONN_ACCEPTED}),s.type==e.COMM_TYPE.ASK&&s.data.action==t&&r(s.data)})),n},t.onTell=function(n,t,o){return n.on("message",(function(n){var r=JSON.parse(n);r.type==e.COMM_TYPE.TELL&&r.data.action==t&&o(r.data)})),n},t.onConnect=function(n,t){return n.on("message",(function(o){JSON.parse(o).type==e.COMM_TYPE.REQUEST_CONN&&t(n)})),n},t.onDisconnect=function(n,e){return n.on("close",e),n}})),o=n((function(n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.runHelper=void 0,o.runHelper=function(n,o,r,i){void 0===i&&(i=console.log);var s,u=new n(r);u.on("open",(function(){i("Connecting as helper."),u.send(JSON.stringify({type:e.COMM_TYPE.REQUEST_CONN,data:{}})),t.onTell(u,e.TELL_ACTIONS.CONN_ACCEPTED,(function(){return i("Connection Accepted.")}))})),u.on("close",(function(){return i("Connection refused or closed unexpectedly.")})),t.onAsk(u,e.ASK_ACTIONS.BUILD_KERNEL,(function(n){i("building"),s=o.createKernel(n.extras.kernelFunc,n.extras.kernelOptions),i("built"),t.tell(u,{action:e.TELL_ACTIONS.KERNEL_BUILT})})),t.onAsk(u,e.ASK_ACTIONS.RUN_KERNEL,(function(n){var o;i("running"),o=n.extras.inputsLength>0?s.apply(void 0,n.extras.inputs):s(),i("done"),t.tell(u,{action:e.TELL_ACTIONS.KERNEL_RUN_DONE,extras:{output:o}})}))}}));const{runHelper:r}=o;class i extends WebSocket{on(n,e){switch(n){case"open":return this.onopen=e;case"error":return this.onerror=e;case"message":return this.onmessage=e;case"close":return this.onclose=e}}}return{hiveHelp:function(n,e,t=console.log){r(i,n,e,t)}}}));
